import*as e from"ethers";import t from"@walletconnect/web3-provider";const n=require("ethers");class r{constructor(e,t){this.web3Provider=t,this.originProvider=e,this.signer=t.getSigner()}async queryContract(e,t,r,...a){return new n.Contract(e,t,this.web3Provider).functions[r](...a)}async runContractTransactionFunc(e,t,r,...a){return new n.Contract(e,t,this.web3Provider.getSigner()).functions[r](...a)}listenForChanges(e,t=(()=>{})){if(!e)throw new Error("This listener item cannot be empty.");if(-1===["chainChanged","accountsChanged","disconnect"].indexOf(e))throw new Error("This listener item does not exist.");try{this.originProvider.on(e,t)}catch(e){console.log("Listen to error."),console.log(e)}}async signMessage(e,t){return await this.originProvider.request({method:"eth_sign",params:[t,e]})}async personalSign(e,t){return this.originProvider.request({method:"personal_sign",params:[e,t],from:t})}formatUnits(e,t){return n.utils.formatUnits(e,t)}}const a=[{id:"ETH-Testnet",name:"ETH Testnet",label:"EHT Rinkeby Testnet",chainId:"0x4",url:"https://ropsten.infura.io/v3/a892bade64884ad6a13cf9981de659eb",explorer:"https://ropsten.etherscan.io/",config:{chainId:"0x4",chainName:"ETH Testnet",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:["https://ropsten.infura.io/v3/a892bade64884ad6a13cf9981de659eb"],blockExplorerUrls:["https://ropsten.etherscan.io/"]}},{id:"BSC-Testnet",name:"BSC Testnet",chainId:"0x61",label:"BSC Testnet",url:"https://data-seed-prebsc-2-s3.binance.org:8545/",explorer:"https://testnet.bscscan.com/",config:{chainId:"0x61",chainName:"BSC Testnet",nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},rpcUrls:["https://data-seed-prebsc-2-s3.binance.org:8545/"],blockExplorerUrls:["https://testnet.bscscan.com/"]}},{id:"OEC-Testnet",name:"OEC Testnet",chainId:"0x41",label:"OEC Testnet",url:"https://exchaintestrpc.okex.org",explorer:"https://www.oklink.com/oec-test/",config:{chainId:"0x41",chainName:"OKExChain Testnet",nativeCurrency:{name:"OKExChain Global Utility Token in testnet",symbol:"OKT",decimals:18},rpcUrls:["https://exchaintestrpc.okex.org"],blockExplorerUrls:["https://www.oklink.com/okexchain-test"]}},{id:"ETH-Mainnet",name:"ETH Mainnet",chainId:"0x1",url:"https://mainnet.infura.io/v3/a892bade64884ad6a13cf9981de659eb",explorer:"https://etherscan.io/",config:{chainId:"0x1",chainName:"ETH Mainnet",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:["https://mainnet.infura.io/v3/a892bade64884ad6a13cf9981de659eb"],blockExplorerUrls:["https://etherscan.io/"]}},{id:"BSC-Mainnet",name:"BSC Mainnet",chainId:"0x38",url:"https://bsc-dataseed.binance.org/",explorer:"https://bscscan.com/",config:{chainId:"0x38",chainName:"Binance Smart Chain",nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},rpcUrls:["https://bsc-dataseed.binance.org/"],blockExplorerUrls:["https://bscscan.com/"]}},{id:"OEC-Mainnet",name:"OEC Mainnet",chainId:"0x42",url:"https://exchainrpc.okex.org",explorer:"https://www.oklink.com/oec/",config:{chainId:"0x42",chainName:"OKExChain Mainnet",nativeCurrency:{name:"OKExChain Global Utility Token",symbol:"OKT",decimals:18},rpcUrls:["https://exchainrpc.okex.org"],blockExplorerUrls:["https://www.oklink.com/okexchain"]}}];!function(e){if(!Array.isArray(e))return void console.log("type error!");let t=[];for(let n=0;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n])}(a.map((e=>e.name.split(" ")[0])));const s=Object.freeze({BSC_TEST:"BSC-Testnet",ETH_TEST:"ETH-Testnet",OEC_TEST:"OEC-Testnet",BSC_MAIN:"BSC-Mainnet",ETH_MAIN:"ETH-Mainnet",OEC_MAIN:"OEC-Mainnet"}),i={[s.BSC_TEST]:97,[s.ETH_TEST]:4,[s.OEC_TEST]:41,[s.BSC_MAIN]:56,[s.ETH_MAIN]:1,[s.OEC_MAIN]:42},o={[i[s.BSC_TEST]]:"https://data-seed-prebsc-2-s3.binance.org:8545/",[i[s.ETH_TEST]]:"https://ropsten.infura.io/v3/a892bade64884ad6a13cf9981de659eb",[i[s.OEC_TEST]]:"https://exchaintestrpc.okex.org",[i[s.BSC_MAIN]]:"https://bsc-dataseed.binance.org/",[i[s.ETH_MAIN]]:"https://mainnet.infura.io/v3/a892bade64884ad6a13cf9981de659eb",[i[s.OEC_TEST]]:"https://exchainrpc.okex.org"};class c extends r{constructor(){if(!window.ethereum)throw new Error("No provider exists for the current environment.");{const t=window.ethereum;super(t,new e.providers.Web3Provider(t))}}async getAddress(){try{return await this.signer.getAddress()}catch(e){if("UNSUPPORTED_OPERATION"===e.code)throw new Error("Please connect your wallet first");console.error(e)}}static getInstance(){return c.instance||(c.instance=new c),c.instance}static connectWallet(e=(()=>{})){window.ethereum.request({method:"eth_requestAccounts"}).then((t=>{e(t[0])})).catch((e=>{console.error(e.message)}))}async switchNetwork(e,t=(()=>{})){let n=await this.getAddress();if(!n)throw new Error("Please connect your wallet first");let r=Object.values(s);if(!e)throw new Error("The param cannot be empty.");if(-1===r.indexOf(e))throw new Error("The param is wrong.");let i=a.find((t=>t.id===e));try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:i.config.chainId}]}),t()}catch(e){4902===e.code?(await window.ethereum.request({method:"wallet_addEthereumChain",params:[i.config,n]}),t()):console.error(e)}}}class h extends r{constructor(t){super(t,new e.providers.Web3Provider(t))}disconnect(){this.originProvider.wc.killSession()}}async function l(e={onSuccess:()=>{},onFail:()=>{}},n){try{let r=Object.values(s);if(!n)throw new Error("The param cannot be empty.");if(-1===r.indexOf(n))throw new Error("The param is wrong.");const a=new t({rpc:o,chainId:i[n]}),c=await a.enable(),l=new h(a);e.onSuccess(l,c[0])}catch(t){e.onFail(t.message)}}export{s as Networks,c as WalletHandler,l as createWalletConnect};
